(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/index/pintuan"],{"078d":function(t,e,n){"use strict";n.r(e);var o=n("a937"),i=n("956f");for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);n("426c");var a,r=n("f0c5"),u=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);e["default"]=u.exports},"3f61":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n("df48"),i=n("cf70");function s(t){return c(t)||u(t)||r(t)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(t,e){if(t){if("string"===typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}function u(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function c(t){if(Array.isArray(t))return d(t)}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var m=function(){n.e("components/uni-segmented-control/uni-segmented-control").then(function(){return resolve(n("5a8b"))}.bind(null,n)).catch(n.oe)},l=function(){n.e("components/lvv-popup/lvv-popup").then(function(){return resolve(n("6125"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/uni-number-box/uni-number-box").then(function(){return resolve(n("ec84"))}.bind(null,n)).catch(n.oe)},h=function(){n.e("components/uni-rate/uni-rate").then(function(){return resolve(n("6c75"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("components/uni-load-more/uni-load-more").then(function(){return resolve(n("897a"))}.bind(null,n)).catch(n.oe)},g=function(){n.e("components/uni-fab/uni-fab").then(function(){return resolve(n("f583"))}.bind(null,n)).catch(n.oe)},v=function(){n.e("components/uni-countdown/uni-countdown").then(function(){return resolve(n("2057"))}.bind(null,n)).catch(n.oe)},b=function(){n.e("components/spec/spec").then(function(){return resolve(n("088b"))}.bind(null,n)).catch(n.oe)},_=function(){n.e("components/share/shareByWx").then(function(){return resolve(n("2a91"))}.bind(null,n)).catch(n.oe)},y=function(){n.e("components/jshop/jshop-content").then(function(){return resolve(n("589b"))}.bind(null,n)).catch(n.oe)},w={components:{uniSegmentedControl:m,lvvPopup:l,uniNumberBox:p,uniRate:h,uniLoadMore:f,uniFab:g,uniCountdown:v,spec:b,jshopContent:y,shareByWx:_},data:function(){return{swiper:{indicatorDots:!0,autoplay:!0,interval:3e3,duration:800},items:["图文详情","商品参数","买家评论"],current:0,goodsId:0,groupId:0,goodsInfo:{pintuan_rule:{pintuan_start_status:1}},cartNums:0,product:{},goodsParams:[],goodsComments:{loadStatus:"more",page:1,limit:5,list:[]},buyNum:1,minBuyNum:1,type:2,isfav:!1,favLogo:["/static/image/ic-me-collect.png","/static/image/ic-me-collect2.png"],horizontal:"right",vertical:"bottom",direction:"vertical",pattern:{color:"#7A7E83",backgroundColor:"#fff",selectedColor:"#007AFF",buttonColor:"#FF7159"},content:[{iconPath:"/static/image/tab-ic-hom-selected.png",selectedIconPath:"/static/image/tab-ic-hom-unselected.png",active:!1,url:"/pages/index/index"},{iconPath:"/static/image/tab-ic-me-selected.png",selectedIconPath:"/static/image/tab-ic-me-unselected.png",active:!1,url:"/pages/member/index/index"}],indicatorDots:!1,autoplay:!1,interval:2e3,duration:500,lasttime:{day:0,hour:!1,minute:0,second:0},pintuanPrice:0,discount_amount:0,price:0,teamCount:0,pintuanRecord:[],remainder_time:{day:0,hour:!1,minute:0,second:0},groupHeight:"groupHeight",teamId:0,teamInfo:{list:[],team_time:{day:0,hour:0,minute:0,second:0}},shareUrl:"/pages/share/jump"}},onLoad:function(e){this.goodsId=e.id,e.team_id&&(this.teamId=e.team_id,this.getTeam(this.teamId)),this.goodsId?(this.getGoodsInfo(),this.getGoodsParams(),this.getGoodsComments()):this.$common.errorToShow("获取失败",(function(){t.navigateBack({delta:1})})),this.getCartNums()},computed:{minNums:function(){return this.product.stock>this.minBuyNum?this.minBuyNum:this.product.stock},isSpes:function(){return!(!this.product.hasOwnProperty("default_spes_desc")||!Object.keys(this.product.default_spes_desc).length)},promotion:function(){var t=[];if(this.product.promotion_list)for(var e in this.product.promotion_list)t.push(this.product.promotion_list[e]);return t},typeName:function(){return 3==this.goodsInfo.group_type?"团购":"秒杀"},shareHref:function(){var t=getCurrentPages(),e=t[t.length-1];return i.apiBaseUrl+"wap/"+e.route+"?id="+this.goodsId+"&group_id="+this.groupId},shopMobile:function(){return this.$store.state.config.shop_mobile||0},goodsShowWord:function(){return this.$store.state.config.goods_show_word}},onReachBottom:function(){2===this.current&&"more"===this.goodsComments.loadStatus&&this.getGoodsComments()},methods:{backBtn:function(){var e=getCurrentPages();e.length>1?t.navigateBack({delta:1}):t.switchTab({url:"/pages/index/index"})},getGoodsInfo:function(){var e=this,n={id:this.goodsId},i=(0,o.get)("userToken");i&&(n["token"]=i);var s=this;s.$api.pintuanGoodsInfo(n,(function(n){if(n.status)if(n.data.length<1)s.$common.errorToShow("该商品不存在，请返回重新选择商品。",(function(){t.navigateBack({delta:1})}));else if(1!=n.data.marketable)s.$common.errorToShow("该商品已下架，请返回重新选择商品。",(function(){t.navigateBack({delta:1})}));else{var o=n.data;s.goodsInfo=o;var a=n.data.product;s.discount_amount=parseFloat(o.pintuan_rule.discount_amount).toFixed(2),s.product=s.spesClassHandle(a),s.isfav="true"===s.goodsInfo.isfav,s.pintuanPrice=e.$common.moneySub(s.product.price,s.discount_amount);var r=Date.parse(new Date)/1e3,u=n.data.pintuan_rule.etime-r;s.lasttime=s.$common.timeToDateObj(u);for(var c=o.pintuan_record,d=new Array,m=0;m<c.length;m++)if(c[m].remainder_time=s.$common.timeToDateObj(c[m].close_time-r),0==m||m%2==0){if(m+1<c.length)var l=[c[m],c[m+1]];else l=[c[m]];d.push(l)}c.length<2?s.groupHeight="groupHeight":s.groupHeight="",s.pintuanRecord=d,s.teamCount=o.pintuan_record_nums,i&&s.goodsBrowsing()}}))},getTeam:function(t){var e=this;this.$api.getOrderPintuanTeamInfo({team_id:t},(function(t){if(t.status){e.teamInfo={list:t.data.teams,current_count:t.data.teams.length,people_number:t.data.people_number,team_nums:t.data.team_nums,close_time:t.data.close_time,id:t.data.id,team_id:t.data.team_id,rule_id:t.data.rule_id,status:t.data.status};var n=Date.parse(new Date)/1e3;e.teamInfo.team_time=e.$common.timeToDateObj(t.data.close_time-n),1==t.data.status?e.pintuanShow():e.teamId=0}else e.$common.errorToShow(t.msg)}))},getCartNums:function(){var t=this,e=this.$db.get("userToken");e&&""!=e&&this.$api.getCartNum({},(function(e){e.status&&(t.cartNums=e.data)}))},toshow:function(t,e){this.type=t,e&&(this.teamId=e),2==this.type?this.price=this.pintuanPrice:this.price=this.product.price,this.$refs.lvvpopref.show()},toclose:function(){this.$refs.lvvpopref.close()},changeSpes:function(e){var n=this,o=e.v,i=e.k;if(this.product.default_spes_desc[o][i].hasOwnProperty("product_id")&&this.product.default_spes_desc[o][i].product_id){var s={id:this.product.default_spes_desc[o][i].product_id,type:"pintuan"},a=this.$db.get("userToken");a&&(s["token"]=a),this.$api.getProductInfo(s,(function(t){1==t.status&&(n.buyNum=t.data.stock>n.minBuyNum?n.minBuyNum:t.data.stock,n.product=n.spesClassHandle(t.data),2==n.type?n.price=n.$common.moneySub(n.product.price,n.discount_amount):n.price=n.product.price)})),t.showLoading({title:"加载中"}),setTimeout((function(){t.hideLoading()}),1e3)}},spesClassHandle:function(t){if(t.hasOwnProperty("default_spes_desc")){var e=t.default_spes_desc;for(var n in e)for(var o in e[n])e[n][o].hasOwnProperty("is_default")&&!0===e[n][o].is_default?this.$set(e[n][o],"cla","pop-m-item selected"):e[n][o].hasOwnProperty("product_id")&&e[n][o].product_id?this.$set(e[n][o],"cla","pop-m-item not-selected"):this.$set(e[n][o],"cla","pop-m-item none");t.default_spes_desc=e}return t},bindChange:function(t){this.buyNum=t},collection:function(){var t=this,e={goods_id:this.goodsInfo.id};this.$api.goodsCollection(e,(function(e){e.status?(t.isfav=!t.isfav,t.$common.successToShow(e.msg)):t.$common.errorToShow(e.msg)}))},onClickItem:function(t){this.current!==t&&(this.current=t)},getGoodsParams:function(){var t=this;this.$api.goodsParams({id:this.goodsId},(function(e){1==e.status&&(t.goodsParams=e.data)}))},getGoodsComments:function(){var t=this,e={page:this.goodsComments.page,limit:this.goodsComments.limit,goods_id:this.goodsId};this.goodsComments.loadStatus="loading",this.$api.goodsComment(e,(function(e){if(1==e.status){var n=e.data.list;n.forEach((function(e){e.ctime=t.$common.timeToDate(e.ctime),e.hasOwnProperty("images_url")||t.$set(e,"images_url",[])})),t.goodsComments.list=[].concat(s(t.goodsComments.list),s(n)),e.data.count>t.goodsComments.list.length?(t.goodsComments.loadStatus="more",t.goodsComments.page++):t.goodsComments.loadStatus="noMore"}else t.$common.errorToShow(e.msg)}))},goodsBrowsing:function(){var t={goods_id:this.goodsInfo.id};this.$api.addGoodsBrowsing(t,(function(t){}))},buyNow:function(){var t=this;if(this.buyNum>0){var e={product_id:this.product.id,nums:this.buyNum,order_type:this.type};this.$api.addCart(e,(function(e){if(e.status){t.toclose();var n=e.data;0==t.teamId?t.$common.navigateTo("/pages/goods/place-order/index?cart_ids="+JSON.stringify(n)+"&order_type="+t.type):t.$common.navigateTo("/pages/goods/place-order/index?cart_ids="+JSON.stringify(n)+"&order_type="+t.type+"&team_id="+t.teamId)}else t.toclose(),t.$common.errorToShow(e.msg)}))}},redirectCart:function(){t.switchTab({url:"/pages/cart/index/index"})},trigger:function(e){this.content[e.index].active=!e.item.active,t.switchTab({url:e.item.url})},goShare:function(){this.$refs.share.show()},closeShare:function(){this.$refs.share.close()},pintuanShow:function(){this.$refs.pintuanpop.show()},clickImg:function(e){t.previewImage({urls:e.split()})},showChat:function(){},getShareUrl:function(){var t=this,e={client:2,url:"/pages/share/jump",type:1,page:3,params:{goods_id:this.goodsId,team_id:this.teamId}},n=this.$db.get("userToken");n&&""!=n&&(e["token"]=n),this.$api.share(e,(function(e){t.shareUrl=e.data}))}},watch:{goodsId:{handler:function(){this.getShareUrl()},deep:!0},teamId:{handler:function(){this.getShareUrl()},deep:!0}},onShareAppMessage:function(){return{title:this.goodsInfo.name,imageUrl:this.goodsInfo.album[0],path:this.shareUrl}}};e.default=w}).call(this,n("543d")["default"])},"426c":function(t,e,n){"use strict";var o=n("e4c5"),i=n.n(o);i.a},"956f":function(t,e,n){"use strict";n.r(e);var o=n("3f61"),i=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=i.a},"9f93":function(t,e,n){"use strict";(function(t){n("7c19");o(n("66fd"));var e=o(n("078d"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},a937:function(t,e,n){"use strict";var o={uniCountdown:function(){return n.e("components/uni-countdown/uni-countdown").then(n.bind(null,"2057"))},uniSegmentedControl:function(){return n.e("components/uni-segmented-control/uni-segmented-control").then(n.bind(null,"5a8b"))},uniRate:function(){return n.e("components/uni-rate/uni-rate").then(n.bind(null,"6c75"))},uniLoadMore:function(){return n.e("components/uni-load-more/uni-load-more").then(n.bind(null,"897a"))},lvvPopup:function(){return n.e("components/lvv-popup/lvv-popup").then(n.bind(null,"6125"))},spec:function(){return n.e("components/spec/spec").then(n.bind(null,"088b"))},uniNumberBox:function(){return n.e("components/uni-number-box/uni-number-box").then(n.bind(null,"ec84"))},uniFab:function(){return n.e("components/uni-fab/uni-fab").then(n.bind(null,"f583"))}},i=function(){var t=this,e=t.$createElement;t._self._c},s=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o}))},e4c5:function(t,e,n){}},[["9f93","common/runtime","common/vendor"]]]);