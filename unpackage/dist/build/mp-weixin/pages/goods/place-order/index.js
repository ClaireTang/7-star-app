(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/place-order/index"],{1203:function(t,o,e){"use strict";e.r(o);var n=e("88a7"),i=e.n(n);for(var s in n)"default"!==s&&function(t){e.d(o,t,(function(){return n[t]}))}(s);o["default"]=i.a},"88a7":function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=e("bbcf"),i=function(){e.e("components/lvv-popup/lvv-popup").then(function(){return resolve(e("6125"))}.bind(null,e)).catch(e.oe)},s=function(){e.e("components/uni-segmented-control/uni-segmented-control").then(function(){return resolve(e("5a8b"))}.bind(null,e)).catch(e.oe)},r={mixins:[n.goods],data:function(){return{type_items:["快递配送","门店自提"],type_current:0,cartData:{},products:[],promotions:[],userShip:{},receiptType:1,params:{ids:0,area_id:0,coupon_code:"",point:0,type:1},invoice:{type:"1",name:"不开发票",code:""},memo:"",items:["选择优惠券","输入券码"],orderType:1,current:0,isUsePoint:!1,userPointNums:0,canUsePoint:0,pointMoney:"",userCoupons:[],usedCoupons:{},inputCouponCode:"",optCoupon:"",store:{id:0,name:"",mobile:"",address:""},store_pick:{name:"",mobile:""},team_id:0,submitStatus:!1}},components:{lvvPopup:i,uniSegmentedControl:s},onLoad:function(o){var e=o.cart_ids;o.order_type&&(this.params.order_type=o.order_type),o.team_id&&(this.team_id=o.team_id),this.params.ids=JSON.parse(e),this.params.ids||this.$common.successToShow("获取失败",(function(){t.navigateBack({delta:1})})),this.userDefaultShip(),this.getUserCounpons(),this.getDefaultStore()},onShow:function(){},methods:{onTypeItem:function(t){this.type_current!==t&&(this.type_current=t);var o=1;0!=this.type_current&&(o=2),this.receiptType=o,this.getCartList()},goStorelist:function(){t.navigateTo({url:"./storelist"})},goAddress:function(){t.navigateTo({url:"/pages/member/address/list?type=order"})},userDefaultShip:function(){var t=this;this.$api.userDefaultShip({},(function(o){o.status&&Object.keys(o.data).length&&(t.userShip=o.data,t.params.area_id=t.userShip.area_id)}))},getCartList:function(){var t=this,o=this.params;o["receipt_type"]=this.receiptType,this.$api.cartList(o,(function(o){if(o.status){var e=o.data;if(1===t.isOpenPoint&&!t.isUsePoint){var n={order_money:e.amount};t.$api.usablePoint(n,(function(o){o.status&&(t.userPointNums=o.data,t.canUsePoint=o.available_point,t.pointMoney=o.point_rmb)}))}e.amount=t.$common.formatMoney(e.amount),e.goods_amount=t.$common.formatMoney(e.goods_amount),e.goods_pmt_old=e.goods_pmt,e.goods_pmt=t.$common.formatMoney(e.goods_pmt),e.coupon_pmt=t.$common.formatMoney(e.coupon_pmt),e.order_pmt_old=e.order_pmt,e.order_pmt=t.$common.formatMoney(e.order_pmt),e.point_money=t.$common.formatMoney(e.point_money),e.cost_freight=t.$common.formatMoney(e.cost_freight),t.cartData=e,t.products=e.list;for(var i=!0,s=0;s<e.list.length;s++)e.list[s].is_select&&(i=!1);i&&t.$common.errorToShow("您所挑选的商品已售罄，请重新添加哦"),t.promotions=e.promotion_list,t.usedCoupons=e.coupon,1===t.current&&t.$refs.lvvpopref.popshow&&t.inputCouponCode&&t.toclose(),t.inputCouponCode="",t.optCoupon=""}else t.$common.errorToShow(o.msg,(function(){var e=[15009,15010,15013,15014,15015];-1!==e.indexOf(o.data)&&(1===t.current?t.removeCouponCode(t.inputCouponCode,t.current):(t.optCoupon&&t.userCoupons.forEach((function(o){o.coupon_code===t.optCoupon&&(o.checked=!1)})),t.removeCouponCode(t.optCoupon,t.current)))}))}))},getUserCounpons:function(){var t=this,o={display:"no_used"};this.$api.userCoupon(o,(function(o){if(o.status){var e=o.data.list,n=Math.round((new Date).getTime()/1e3).toString();e.forEach((function(o){t.$set(o,"checked",!1),t.$set(o,"disabled",o.start_time>n),t.$set(o,"cla",o.disabled?"cci-l bg-c":"cci-l")})),t.userCoupons=e}}))},couponHandle:function(t){this.userCoupons[t].checked=!this.userCoupons[t].checked,this.optCoupon=this.userCoupons[t].coupon_code;var o=[];if(this.userCoupons.forEach((function(t){t.checked&&o.push(t.coupon_code)})),this.userCoupons[t].checked)this.params.coupon_code=o.join();else{var e=this.params.coupon_code.split(","),n=e.indexOf(this.userCoupons[t].coupon_code);-1!==n&&(e.splice(n,1),this.params.coupon_code=e.join())}},useInputCouponCode:function(){this.inputCouponCode?this.params.coupon_code.length>0?this.params.coupon_code+=","+this.inputCouponCode:this.params.coupon_code=this.inputCouponCode:this.$common.errorToShow("请输入优惠券码")},notUseCoupon:function(){this.toclose(),this.inputCouponCode="",this.userCoupons.forEach((function(t){t.checked=!1})),this.params.coupon_code=""},removeCouponCode:function(t,o){var e=this.params.coupon_code.split(",");e.splice(e.indexOf(t),1),0===o?this.optCoupon="":this.inputCouponCode="",this.params.coupon_code=e.join()},changePointHandle:function(){this.userPointNums>0&&(this.isUsePoint=!this.isUsePoint,this.params.point=this.isUsePoint?this.canUsePoint:0)},toshow:function(){this.$refs.lvvpopref.show()},toclose:function(){this.$refs.lvvpopref.close()},toPay:function(t){var o=this;this.submitStatus=!0;var e=1;0!=this.type_current&&(e=2),this.receiptType=e;var n={cart_ids:this.params.ids,memo:this.memo,coupon_code:this.params.coupon_code,point:this.params.point,receipt_type:this.receiptType};n["order_type"]=this.params.order_type,0!=this.team_id&&(n["params"]=JSON.stringify({team_id:this.team_id}));var i={};if(1==this.receiptType){if(!this.userShip.id||!this.params.area_id)return this.$common.errorToShow("请选择收货地址"),this.submitStatus=!1,!1;i={uship_id:this.userShip.id,area_id:this.params.area_id}}if(2==this.receiptType){if(!this.store.id)return this.$common.errorToShow("请选择自提门店"),this.submitStatus=!1,!1;if(!this.store_pick.name)return this.$common.errorToShow("请输入提货人姓名"),this.submitStatus=!1,!1;if(!this.store_pick.mobile)return this.$common.errorToShow("请输入提货人电话"),this.submitStatus=!1,!1;i={store_id:this.store.id,lading_name:this.store_pick.name,lading_mobile:this.store_pick.mobile}}n["tax_type"]=this.invoice.type,n["tax_name"]=this.invoice.name,n["tax_code"]=this.invoice.code,n["source"]=3,n["formId"]=t.detail.formId,n=Object.assign(n,i),this.$api.createOrder(n,(function(t){t.status?"2"==t.data.pay_status?o.$common.redirectTo("/pages/goods/payment/result?order_id="+t.data.order_id):o.$common.redirectTo("/pages/goods/payment/index?order_id="+t.data.order_id+"&type="+o.orderType):o.$common.errorToShow(t.msg)}),(function(t){o.submitStatus=!1}))},goInvoice:function(){this.$common.navigateTo("./invoice")},showAddressList:function(){this.$common.navigateTo("/pages/member/address/list?type=order")},onClickItem:function(t){this.current!==t&&(this.current=t)},getDefaultStore:function(){var t=this;1==this.storeSwitch&&this.$api.defaultStore({},(function(o){if(o.status)if(o.data&&o.data.id){var e={id:o.data.id||0,name:o.data.store_name||"",mobile:o.data.store_mobile||"",address:o.data.all_address||""};t.store=e}else t.$common.errorToShow("商家未配置默认自提店铺！")}))}},computed:{productNums:function(){var t=0;for(var o in this.cartData.list)this.cartData.list[o].is_select&&(t+=this.cartData.list[o].nums);return t},isOpenPoint:function(){return this.$store.state.config.point_switch},usedCouponsCompute:function(){var t="未使用";if(Object.keys(this.usedCoupons).length){var o=[];for(var e in this.usedCoupons)o.push(this.usedCoupons[e]);t=o.join()}return t},invoiceSwitch:function(){return this.$store.state.config.invoice_switch||2},storeSwitch:function(){return this.$store.state.config.store_switch||2},couponIsUsed:function(){return this.cartData.coupon instanceof Array}},watch:{params:{handler:function(){this.getCartList()},deep:!0}}};o.default=r}).call(this,e("543d")["default"])},a134:function(t,o,e){},e3cc:function(t,o,e){"use strict";e.r(o);var n=e("f5ef"),i=e("1203");for(var s in i)"default"!==s&&function(t){e.d(o,t,(function(){return i[t]}))}(s);e("f407");var r,a=e("f0c5"),u=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],r);o["default"]=u.exports},f367:function(t,o,e){"use strict";(function(t){e("7c19");n(e("66fd"));var o=n(e("e3cc"));function n(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("543d")["createPage"])},f407:function(t,o,e){"use strict";var n=e("a134"),i=e.n(n);i.a},f5ef:function(t,o,e){"use strict";var n={uniSegmentedControl:function(){return e.e("components/uni-segmented-control/uni-segmented-control").then(e.bind(null,"5a8b"))},lvvPopup:function(){return e.e("components/lvv-popup/lvv-popup").then(e.bind(null,"6125"))}},i=function(){var t=this,o=t.$createElement;t._self._c},s=[];e.d(o,"b",(function(){return i})),e.d(o,"c",(function(){return s})),e.d(o,"a",(function(){return n}))}},[["f367","common/runtime","common/vendor"]]]);