(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cart/index/index"],{"16ad":function(t,a,s){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var i=s("bbcf"),o=function(){s.e("components/uni-number-box/uni-number-box").then(function(){return resolve(s("ec84"))}.bind(null,s)).catch(s.oe)},n={mixins:[i.goods],data:function(){return{startX:0,startY:0,cartData:{},cartIds:[],checkboxAll:!1,total:0,goSettlement:!1,cartId:"",cartNum:"",isLoad:!1,cartNums:0,editStatus:!1}},components:{uniNumberBox:o},onShow:function(){var t=this.$db.get("userToken");t&&this.getCartData()},computed:{shopName:function(){return this.$store.state.config.shop_name},goods_stocks_warn:function(){return this.$store.state.config.goods_stocks_warn}},methods:{checkboxChange:function(t){var a=this,s=t,i=a.cartData;for(var o in i.list)i.list[o].id==s&&(1==i.list[o].is_select?i.list[o].is_select=!1:i.list[o].is_select=!0);a.cartData=i,a.setNumsData(),a.isAllCheckbox()},arrayToStr:function(t){return t.toString()},getCartData:function(){var t=this,a=t.arrayToStr(t.cartIds),s={ids:a,display:"all"};this.$api.cartList(s,(function(a){if(a.status){var s=a.data;t.showHandle(s)}}))},showHandle:function(t){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this,i=!1;for(var o in t.list){t.list[o].nums<1&&(t.list[o].nums=1);var n=!1,e=t.list[o].products.stock;t.list[o].nums>t.list[o].products.stock&&(n=!0,e=t.list[o].nums),t.list[o].maxStock=e,t.list[o].stockNo=n;var r=!1;if(s.goods_stocks_warn>=t.list[o].products.stock&&(r=!0),t.list[o].stockTension=r,t.list[o].minStatus="normal",t.list[o].maxStatus="normal",1==t.list[o].nums&&(t.list[o].minStatus="disabled"),t.list[o].nums==t.list[o].products.stock&&(t.list[o].maxStatus="disabled"),t.list[o].spes=[],null!=t.list[o].products.spes_desc){var c=t.list[o].products.spes_desc.split(",");for(var l in c){var u=c[l].split(":");t.list[o].spes.push(u[1])}}t.list[o].isTouchMove=!1,t.list[o].is_select&&(i=!0),t.list[o].id=s.arrayToStr(t.list[o].id),a&&t.list[o].is_select&&s.cartIds.indexOf(t.list[o].id)<0&&s.cartIds.push(t.list[o].id)}t.goods_pmt=s.$common.formatMoney(t.goods_pmt,2,""),t.order_pmt=s.$common.formatMoney(t.order_pmt,2,""),t.amount=s.$common.formatMoney(t.amount,2,"");var d=!1;t.list.length<1&&(d=!0);var f=0;for(var m in t.promotion_list)f++;s.goSettlement=i,s.isLoad=d,s.cartNums=f,a?s.cartData=t:s.getCartData(),s.isAllCheckbox()},isAllCheckbox:function(){var t=this,a=t.cartData.list,s=!1,i=!0;for(var o in a)0==a[o].is_select&&0==a[o].stockNo&&(i=!1),1==a[o].is_select&&(s=!0);a.length<=0&&(i=!1),t.checkboxAll=i,t.goSettlement=s},checkboxAllButton:function(t){1==this.checkboxAll?(this.checkboxAll=!1,this.setAllCheckbox(!1)):(this.checkboxAll=!0,this.setAllCheckbox(!0))},setAllCheckbox:function(t){var a=this,s=a.cartData;if(t)for(var i in s.list)0==s.list[i].stockNo&&(s.list[i].is_select=!0);else for(var o in s.list)s.list[o].is_select=!1;a.cartData=s,a.setNumsData(),a.isAllCheckbox()},setNumsData:function(){var t=this,a=t.cartData,s=[];for(var i in a.list)a.list[i].is_select&&s.push(a.list[i].id);if(t.cartIds=s,t.cartData=a,0==s.length){var o=t.cartData;for(var n in o.promotion_list)o.promotion_list[n].type=1;o.goods_pmt="0.00",o.order_pmt="0.00",o.amount="0.00",t.cartData=o}else t.getCartData()},bindChange:function(t,a){var s=this,i=a.id,o=t,n=s.cartData,e=!1;for(var r in n.list)n.list[r].id==i&&o<=n.list[r].products.stock&&(n.list[r].nums=o,e=!0);return e&&(s.cartData=n,s.cartId=i,s.cartNum=o,s.$common.throttle(s.bindCartNumberOperation,s,350)),!1},bindCartNumberOperation:function(){var t=this;t.setCartNum(t.cartId,t.cartNum)},setCartNum:function(t,a){var s=this,i={id:t,nums:a};s.$api.setCartNum(i,(function(a){s.cartIds.indexOf(t)>-1?a.status?s.$nextTick((function(){s.showHandle(a.data,!1)})):s.$common.errorToShow(a.msg):s.$nextTick((function(){s.showHandle(a.data,!1)}))}))},del:function(t,a){var s=this,i=a;s.cartData.list.splice(t,1),s.cartData=s.cartData,s.isLoad=!0;var o={ids:i};s.$api.removeCart(o,(function(t){t.status&&s.$common.successToShow(t.msg),s.setNumsData(),s.isAllCheckbox()}))},collection:function(a){var s=this;app.db.userToken((function(i){var o={goods_id:a.currentTarget.dataset.goodsid};app.api.goodsCollection(o,(function(i){for(var o in s.cartData.list)s.cartData.list[o].products.goods_id==a.currentTarget.dataset.goodsid&&("收藏成功"==i.msg?s.cartData.list[o].isCollection=!0:s.cartData.list[o].isCollection=!1);wx.showToast({title:i.msg,complete:function(){setTimeout((function(){t.hideToast()}),1e3)}})}))}))},settlement:function(t){var a=this;if(a.goSettlement){var s=a.cartData.list,i="";for(var o in s)1==s[o].is_select&&(i+=","+s[o].id);if(","==i.substr(0,1)&&(i=i.substr(1)),i.length>0)return a.$common.navigateTo("/pages/goods/place-order/index?cart_ids="+JSON.stringify(i)),!0}},touchstart:function(t){var a=this;a.cartData.list.forEach((function(t,a){t.isTouchMove&&(t.isTouchMove=!1)})),a.setData({startX:t.changedTouches[0].clientX,startY:t.changedTouches[0].clientY,cartData:a.cartData})},touchmove:function(t){var a=this,s=t.currentTarget.dataset.index,i=a.startX,o=a.startY,n=t.changedTouches[0].clientX,e=t.changedTouches[0].clientY,r=a.angle({X:i,Y:o},{X:n,Y:e});a.cartData.list.forEach((function(t,a){t.isTouchMove=!1,Math.abs(r)>30||a==s&&(t.isTouchMove=!(n>i))})),a.setData({cartData:a.cartData})},angle:function(t,a){var s=a.X-t.X,i=a.Y-t.Y;return 360*Math.atan(i/s)/(2*Math.PI)},editBtn:function(){this.editStatus=!0},editNoBtn:function(){var t=this;this.editStatus=!1;var a=!1;for(var s in t.cartData.list)if(t.cartData.list[s].is_select){a=!0;break}a&&t.getCartData()},delList:function(){var t=this,a=[];for(var s in t.cartData.list)t.cartData.list[s].is_select&&(a+=t.cartData.list[s].id+",");var i={ids:a};t.$api.removeCart(i,(function(a){a.status&&t.$common.successToShow(a.msg),t.setNumsData(),t.isAllCheckbox()}))}}};a.default=n}).call(this,s("543d")["default"])},"25f2":function(t,a,s){"use strict";var i={uniNumberBox:function(){return s.e("components/uni-number-box/uni-number-box").then(s.bind(null,"ec84"))}},o=function(){var t=this,a=t.$createElement;t._self._c},n=[];s.d(a,"b",(function(){return o})),s.d(a,"c",(function(){return n})),s.d(a,"a",(function(){return i}))},"4b7b":function(t,a,s){},"916e":function(t,a,s){"use strict";var i=s("4b7b"),o=s.n(i);o.a},a521:function(t,a,s){"use strict";s.r(a);var i=s("25f2"),o=s("b0f8");for(var n in o)"default"!==n&&function(t){s.d(a,t,(function(){return o[t]}))}(n);s("916e");var e,r=s("f0c5"),c=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],e);a["default"]=c.exports},b0f8:function(t,a,s){"use strict";s.r(a);var i=s("16ad"),o=s.n(i);for(var n in i)"default"!==n&&function(t){s.d(a,t,(function(){return i[t]}))}(n);a["default"]=o.a},fe1f:function(t,a,s){"use strict";(function(t){s("7c19");i(s("66fd"));var a=i(s("a521"));function i(t){return t&&t.__esModule?t:{default:t}}t(a.default)}).call(this,s("543d")["createPage"])}},[["fe1f","common/runtime","common/vendor"]]]);